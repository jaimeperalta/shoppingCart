(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{TtBp:function(t,e,n){"use strict";n.r(e),n.d(e,"WelcomeModule",function(){return M});var i=n("72+5"),o=n("tyNb"),s=n("mrSG"),c=n("3Pt+"),r=n("fXoL"),a=n("lGQG"),l=n("PScX"),u=n("JZFu");let d=(()=>{class t{constructor(t){this.authService=t,this.product=[]}createProduct(t){return console.log(t),new Promise(e=>Object(s.b)(this,void 0,void 0,function*(){let n=yield this.uploadImage(t.image);if("success"==n.status){let i=this.authService.getUser(),o=yield this.insertProduct(t,n.id,n.url,i.uid);e({status:o.status})}else e({status:n.status})}))}insertProduct(t,e,n,i){return t.image=n,new Promise(n=>{u.a.firestore().collection("products").doc(e).set(Object.assign(Object.assign({},t),{uid:i})).then(()=>{n({status:"success"})}).catch(t=>{console.log(t),n({status:"fail"})})})}uploadImage(t){return new Promise(e=>{let n=u.a.firestore().collection("products").doc().id;console.log(n);let i=u.a.storage().ref(`images/products/${n}`);i.putString(t,"data_url").then(t=>Object(s.b)(this,void 0,void 0,function*(){console.log("Uploaded a data_url string! ");let t=yield i.getDownloadURL();console.log("la url ",t),e({status:"success",id:n,url:t})})).catch(t=>{e({status:"fail",id:""})})})}getProducts(){return new Promise(t=>{u.a.firestore().collection("products").get().then(e=>{if(console.log(e),e.empty)t([]);else{let n=e.docs.map(t=>Object.assign(Object.assign({},t.data()),{key:t.id}));t(n)}}).catch(e=>{console.log(e),t([])})})}}return t.\u0275fac=function(e){return new(e||t)(r.Yb(a.a))},t.\u0275prov=r.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var b=n("B+r4"),p=n("OzZK"),g=n("RwU8"),m=n("C2AL");let h=(()=>{class t{constructor(t){this.authService=t}addToCart(t){return new Promise(e=>Object(s.b)(this,void 0,void 0,function*(){let n=this.authService.getUser();n||e({status:"noUser"});let i=yield this.searchActualCart(n.uid);if("noCart"==i.status){let i=yield this.createCart(n.uid);if("successCreate"==i.status){let n=yield this.insertCart(t.key,i.id);e({status:n.status})}else e({status:i.status})}else{let n=yield this.insertCart(t.key,i.id);e({status:n.status})}}))}searchActualCart(t){return new Promise(e=>{u.a.firestore().collection("carts").doc(t).collection("cartsList").get().then(t=>{if(console.log(t),t.empty)e({status:"noCart"});else{let n=t.docs.filter(t=>"pending"==t.data().status);console.log(n),e(n.length>0?{status:"cartExist",id:n[0].id}:{status:"noCart"})}}).catch(t=>{e({status:"errorGetCart"})})})}createCart(t){return new Promise(e=>{let n=u.a.firestore().collection(`carts/${t}/carts`).doc().id;u.a.firestore().collection("carts").doc(t).collection("cartsList").doc(n).set({id:n,status:"pending"}).then(t=>{e({status:"successCreate",id:n})}).catch(t=>{e({status:"errorCreate",id:n})})})}insertCart(t,e){return new Promise(n=>Object(s.b)(this,void 0,void 0,function*(){let i=yield this.verifyProductCartExist(t,e);"newData"==i.status?u.a.firestore().collection("products_carts").doc().set({product_id:t,cart_id:e,quantity:1}).then(t=>{n({status:"success"})}).catch(t=>{n({status:"failInsertCart"})}):(console.log("actualizando producto del carrito"),u.a.firestore().collection("products_carts").doc(i.id).update({quantity:u.a.firestore.FieldValue.increment(1)}).then(t=>{n({status:"success"})}).catch(t=>{n({status:"failInsertCart"})}))}))}verifyProductCartExist(t,e){return new Promise(n=>{u.a.firestore().collection("products_carts").where("cart_id","==",e).where("product_id","==",t).get().then(t=>{if(t.empty)n({status:"newData",id:""});else{let e=t.docs.map(t=>t.id);console.log("data  verify",e[0]),n({status:"update",id:e[0]})}})})}}return t.\u0275fac=function(e){return new(e||t)(r.Yb(a.a))},t.\u0275prov=r.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=n("ofXK"),z=n("dEAy"),v=n("6ekq"),C=n("FwiY"),O=n("JA5x");function P(t,e){if(1&t&&r.Pb(0,"img",18),2&t){const t=r.ec().$implicit;r.kc("alt",t.name),r.kc("src",t.image,r.sc)}}function S(t,e){if(1&t){const t=r.Vb();r.Ub(0,"div",14),r.bc("click",function(){r.qc(t);const n=e.$implicit;return r.ec().showModal(n)}),r.Ub(1,"nz-card",15),r.Pb(2,"nz-card-meta",16),r.Tb(),r.xc(3,P,1,2,"ng-template",null,17,r.yc),r.Tb()}if(2&t){const t=e.$implicit,n=r.pc(4);r.Bb(1),r.jc("nzCover",n),r.Bb(1),r.kc("nzTitle",t.name),r.kc("nzDescription",t.description)}}let T=(()=>{class t{constructor(t,e,n){this.productsService=t,this.cartService=e,this.message=n,this.products=[],this.isVisible=!1,this.productState={name:"",image:"",description:"",sku:"",key:""},this.productDetails=this.productState}ngOnInit(){this.getProducts()}getProducts(){return Object(s.b)(this,void 0,void 0,function*(){this.products=yield this.productsService.getProducts(),console.log(this.products)})}add(){return Object(s.b)(this,void 0,void 0,function*(){let t=yield this.cartService.addToCart(this.productDetails);console.log("agregar ",t),"success"==t.status?(this.message.success("Producto agregado al carrito"),this.isVisible=!1,this.productDetails=this.productState):"noUser"==t.status?this.message.error("Inicia sesi\xf3n para agregar el producto"):this.message.warning("Algo salido mal al agregar el producto, intenta m\xe1s tarde")})}showModal(t){this.productDetails=t,this.isVisible=!0}handleCancel(){this.isVisible=!1}}return t.\u0275fac=function(e){return new(e||t)(r.Ob(d),r.Ob(h),r.Ob(l.b))},t.\u0275cmp=r.Ib({type:t,selectors:[["app-product-list"]],decls:20,vars:5,consts:[["nz-row","",1,"productList"],["nz-col","","nzSpan","6",3,"click",4,"ngFor","ngForOf"],["nzClassName","modalProductDetails",3,"nzVisible","nzVisibleChange","nzOnCancel"],["nz-row",""],["nz-col","","nzSpan","12"],["nz-row","",1,"contentLeft"],["nz-col","","nzSpan","24",1,"contentTitle"],["nz-col","","nzSpan","24",1,"contentImg"],["nz-image","","alt","",3,"nzSrc"],["nz-row","",1,"contentRigth"],["nz-col","","nzSpan","24",1,"contentDescription"],["nz-col","","nzSpan","24",1,"contentButtons"],["nz-button","","nzType","dashed","nzSize","large","nzShape","round",3,"click"],["nz-icon","","nzType","shopping-cart","nzTheme","outline"],["nz-col","","nzSpan","6",3,"click"],["nzHoverable","",2,"width","240px",3,"nzCover"],[3,"nzTitle","nzDescription"],["coverTemplate",""],[1,"imgProduct",3,"alt","src"]],template:function(t,e){1&t&&(r.Ub(0,"div",0),r.xc(1,S,5,3,"div",1),r.Tb(),r.Ub(2,"nz-modal",2),r.bc("nzVisibleChange",function(t){return e.isVisible=t})("nzOnCancel",function(){return e.handleCancel()}),r.Ub(3,"div",3),r.Ub(4,"div",4),r.Ub(5,"div",5),r.Ub(6,"div",6),r.Ub(7,"p"),r.zc(8),r.Tb(),r.Tb(),r.Ub(9,"div",7),r.Pb(10,"img",8),r.Tb(),r.Tb(),r.Tb(),r.Ub(11,"div",4),r.Ub(12,"div",9),r.Ub(13,"div",10),r.Ub(14,"p"),r.zc(15),r.Tb(),r.Tb(),r.Ub(16,"div",11),r.Ub(17,"button",12),r.bc("click",function(){return e.add()}),r.Pb(18,"i",13),r.zc(19,"Agregar al carrito"),r.Tb(),r.Tb(),r.Tb(),r.Tb(),r.Tb(),r.Tb()),2&t&&(r.Bb(1),r.jc("ngForOf",e.products),r.Bb(1),r.jc("nzVisible",e.isVisible),r.Bb(6),r.Ac(e.productDetails.name),r.Bb(2),r.kc("nzSrc",e.productDetails.image),r.Bb(5),r.Ac(e.productDetails.description))},directives:[b.c,f.j,z.a,b.a,v.a,p.a,g.a,m.a,C.a,O.a,O.b],styles:[".imgProduct[_ngcontent-%COMP%]{height:200px;object-fit:cover}.contentLeft[_ngcontent-%COMP%]   .contentTitle[_ngcontent-%COMP%]{text-align:center;font-size:16px;font-weight:700}.contentLeft[_ngcontent-%COMP%]   .contentImg[_ngcontent-%COMP%]{text-align:center}.contentLeft[_ngcontent-%COMP%]   .contentImg[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:300px;object-fit:contain}.contentRigth[_ngcontent-%COMP%]   .contentDescription[_ngcontent-%COMP%]{text-align:left;font-size:14px;max-height:300px;overflow-y:scroll;margin:25px 15px 15px;white-space:break-spaces}.contentButtons[_ngcontent-%COMP%]{text-align:center}.contentButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#4bea4b;color:#fff!important}"]}),t})();var w=n("ocnv"),y=n("PTRe");function U(t,e){if(1&t&&(r.Ub(0,"div",18),r.Pb(1,"img",19),r.Tb()),2&t){const t=r.ec();r.Bb(1),r.kc("nzSrc",t.imageSelect)}}const k=[{path:"",component:(()=>{class t{constructor(t,e,n,i){this.authService=t,this.fb=e,this.message=n,this.productService=i,this.isLoadingOne=!1,this.isLoadingTwo=!1,this.isVisible=!1,this.isOkLoading=!1,this.imageSelect=""}ngOnInit(){this.validateForm=this.fb.group({name:[null,[c.m.required]],sku:[null,[c.m.required]],description:[null,[c.m.required]]})}showModal(){this.isVisible=!0}handleCancel(){this.isVisible=!1}submitForm(){return Object(s.b)(this,void 0,void 0,function*(){if(console.log("algo"),"VALID"==this.validateForm.status)""==this.imageSelect?this.message.error("Debes subir una imagen"):(console.log(this.validateForm),this.isOkLoading=!0,"success"==(yield this.productService.createProduct(Object.assign(Object.assign({},this.validateForm.value),{image:this.imageSelect}))).status?(this.message.success("Producto creado correctamente"),this.isVisible=!1):this.message.error("Ocurrio un error al crear tu producto, intenta mas tarde"),this.isOkLoading=!1);else for(const t in this.validateForm.controls)this.validateForm.controls[t].markAsDirty(),this.validateForm.controls[t].updateValueAndValidity()})}login(){this.authService.login()}signup(){this.authService.signup()}logout(){this.authService.logout().then(t=>{console.log(t)})}getImage(t){console.log(t);const e=t.target.files[0];console.log(e);const n=new FileReader;n.readAsDataURL(e),n.onload=()=>{this.imageSelect=n.result}}}return t.\u0275fac=function(e){return new(e||t)(r.Ob(a.a),r.Ob(c.c),r.Ob(l.b),r.Ob(d))},t.\u0275cmp=r.Ib({type:t,selectors:[["app-welcome"]],decls:35,vars:10,consts:[["nz-row","",1,"productList"],["nz-col","","nzSpan","24"],["nz-button","","nzType","primary",3,"click"],["nzTitle","Nuevo Producto","nzClassName","modalCreate",3,"nzVisible","nzOkLoading","nzVisibleChange","nzOnCancel","nzOnOk"],["nz-form","",3,"formGroup"],["nzRequired","","nzFor","name",3,"nzSpan"],["nzErrorTip","Completa el nombre del producto!",3,"nzSpan"],["id","note","type","text","nz-input","","formControlName","name"],["nzRequired","","nzFor","sku",3,"nzSpan"],["nzErrorTip","Completa el SKU!",3,"nzSpan"],["id","note","type","text","nz-input","","formControlName","sku"],["nzRequired","","nzFor","description",3,"nzSpan"],["nzErrorTip","Agrega una description para tu producto!",3,"nzSpan"],["id","note","rows","5","type","text","nz-input","","formControlName","description"],["nz-row","",1,"uploadImage"],["for","myfile"],["type","file","id","myfile","name","myfile",3,"change"],["nz-col","","nzSpan","24","class","imgPreview",4,"ngIf"],["nz-col","","nzSpan","24",1,"imgPreview"],["nz-image","","width","200px","height","200px","alt","",3,"nzSrc"]],template:function(t,e){1&t&&(r.Ub(0,"div",0),r.Ub(1,"div",1),r.Ub(2,"button",2),r.bc("click",function(){return e.login()}),r.zc(3,"Login"),r.Tb(),r.Ub(4,"button",2),r.bc("click",function(){return e.signup()}),r.zc(5,"Signup"),r.Tb(),r.Ub(6,"button",2),r.bc("click",function(){return e.logout()}),r.zc(7,"Logout"),r.Tb(),r.Ub(8,"button",2),r.bc("click",function(){return e.showModal()}),r.Ub(9,"span"),r.zc(10,"Show Modal"),r.Tb(),r.Tb(),r.Pb(11,"app-product-list"),r.Tb(),r.Tb(),r.Ub(12,"nz-modal",3),r.bc("nzVisibleChange",function(t){return e.isVisible=t})("nzOnCancel",function(){return e.handleCancel()})("nzOnOk",function(){return e.submitForm()}),r.Ub(13,"form",4),r.Ub(14,"nz-form-item"),r.Ub(15,"nz-form-label",5),r.zc(16,"Nombre"),r.Tb(),r.Ub(17,"nz-form-control",6),r.Pb(18,"input",7),r.Tb(),r.Tb(),r.Ub(19,"nz-form-item"),r.Ub(20,"nz-form-label",8),r.zc(21,"SKU"),r.Tb(),r.Ub(22,"nz-form-control",9),r.Pb(23,"input",10),r.Tb(),r.Tb(),r.Ub(24,"nz-form-item"),r.Ub(25,"nz-form-label",11),r.zc(26,"Descripcion"),r.Tb(),r.Ub(27,"nz-form-control",12),r.Pb(28,"textarea",13),r.Tb(),r.Tb(),r.Tb(),r.Ub(29,"div",14),r.Ub(30,"div",1),r.Ub(31,"label",15),r.zc(32,"Subir imagen:"),r.Tb(),r.Ub(33,"input",16),r.bc("change",function(t){return e.getImage(t)}),r.Tb(),r.Tb(),r.xc(34,U,2,1,"div",17),r.Tb(),r.Tb()),2&t&&(r.Bb(12),r.jc("nzVisible",e.isVisible)("nzOkLoading",e.isOkLoading),r.Bb(1),r.jc("formGroup",e.validateForm),r.Bb(2),r.jc("nzSpan",24),r.Bb(2),r.jc("nzSpan",24),r.Bb(3),r.jc("nzSpan",24),r.Bb(2),r.jc("nzSpan",24),r.Bb(3),r.jc("nzSpan",24),r.Bb(2),r.jc("nzSpan",24),r.Bb(7),r.jc("ngIf",""!=e.imageSelect))},directives:[b.c,b.a,p.a,g.a,m.a,T,z.a,c.n,c.j,w.b,c.f,w.c,w.d,w.a,y.a,c.b,c.i,c.e,f.k,v.a],styles:["[_nghost-%COMP%]{width:100%}[_nghost-%COMP%]     .upload-list-inline .ant-upload-list-item{float:left;width:200px;margin-right:8px}[_nghost-%COMP%]     .upload-list-inline [class*=-upload-list-rtl] .ant-upload-list-item{float:right}[_nghost-%COMP%]     .upload-list-inline .ant-upload-animate-enter{animation-name:uploadAnimateInlineIn}[_nghost-%COMP%]     .upload-list-inline .ant-upload-animate-leave{animation-name:uploadAnimateInlineOut}.imgPreview[_ngcontent-%COMP%]{text-align:center;padding:15px}"]}),t})()}];let j=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.Mb({type:t}),t.\u0275inj=r.Lb({imports:[[o.e.forChild(k)],o.e]}),t})(),x=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.Mb({type:t}),t.\u0275inj=r.Lb({imports:[[f.b,i.a]]}),t})(),M=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.Mb({type:t}),t.\u0275inj=r.Lb({imports:[[f.b,j,i.a,c.g,c.l,x]]}),t})()}}]);